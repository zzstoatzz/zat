when:
  - event: ["push"]
    branch: main

engine: nixery

dependencies:
  nixpkgs:
    - bun
    - curl

environment:
  WISP_DID: "did:plc:mkqt76xvfgxuemlwlx6ruc3w"
  WISP_SITE_NAME: "docs"

steps:
  - name: build site
    command: |
      bun ./scripts/build-site.mjs

  - name: deploy docs to wisp
    command: |
      test -n "$WISP_APP_PASSWORD"
      curl -sSL https://sites.wisp.place/nekomimi.pet/wisp-cli-binaries/wisp-cli-x86_64-linux -o wisp-cli
      chmod +x wisp-cli
      ./wisp-cli deploy "$WISP_DID" --path ./site-out --site "$WISP_SITE_NAME" --password "$WISP_APP_PASSWORD"

when:
  - event: ["push"]
    branch: main

engine: nixery

dependencies:
  nixpkgs:
    - nodejs
    - coreutils
    - curl

environment:
  WISP_HANDLE: "zat.dev"
  WISP_SITE_NAME: "docs"

steps:
  - name: build docs site
    command: |
      node ./scripts/build-wisp-docs.mjs

  - name: deploy docs to wisp
    command: |
      test -n "$WISP_APP_PASSWORD"
      curl -sSL https://sites.wisp.place/nekomimi.pet/wisp-cli-binaries/wisp-cli-x86_64-linux -o wisp-cli
      chmod +x wisp-cli
      ./wisp-cli deploy "$WISP_HANDLE" --path ./site-out --site "$WISP_SITE_NAME" --password "$WISP_APP_PASSWORD"
